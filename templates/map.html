{% extends 'base.html' %}

{% block content %}

<div class="jumbotron">
    <div class="container text-center">
        <div id="map" style="width:500px; height:400px; margin:0 auto;"></div>
    </div>
</div>

<script src="http://dapi.kakao.com/v2/maps/sdk.js?appkey=38d34c29c097c5f5c8c02416cb4aefff"></script>
<script>
    navigator.geolocation.getCurrentPosition(function(position) {
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            // alert(lat + ',' + lng);

        var container = document.getElementById('map');
        var options = {
            center : new kakao.maps.LatLng(36.542258, 128.796883), // 안동대학교 (지도 중심 위치)
            level : 4
        };
        var map = new kakao.maps.Map(container, options);
        var markerPosition = new kakao.maps.LatLng(36.542258, 128.796883);  // 마커표시
        var marker = new kakao.maps.Marker({
            position: markerPosition
        });
        marker.setMap(map);

        $.ajax({
            url: '/map_data/',
            data: {
            'lat' : lat, 'lng' : lng
            },
            success: function(res) {
                for(var i = 0; i < res.length; i++) {
                    var marker = new kakao.maps.Marker({
                        map : map, // 마커를 표시할 지도
                        position : new kakao.maps.LatLng(res[i].lat, res[i].lng),
                        title : res[i].title,
                    });
                }
            }
        });

        // 커스텀 오버레이에 표시할 컨텐츠 입니다
        // 커스텀 오버레이는 아래와 같이 사용자가 자유롭게 컨텐츠를 구성하고 이벤트를 제어할 수 있기 때문에
        // 별도의 이벤트 메소드를 제공하지 않습니다 
        var content = '<div class="wrap">' + 
                    '    <div class="info">' + 
                    '        <div class="title">' + 
                    '            국립안동대학교' + 
                    '            <div class="close" onclick="closeOverlay()" title="닫기"></div>' + 
                    '        </div>' + 
                    '        <div class="body">' + 
                    '            <div class="img">' +
                    '                <img src="https://cfile181.uf.daum.net/image/250649365602043421936D" width="73" height="70">' +
                    '           </div>' + 
                    '            <div class="desc">' + 
                    '                <div class="ellipsis">경상북도 안동시 경동로 1375</div>' + 
                    '                <div class="jibun ellipsis">054-820-5114</div>' + 
                    '                <div><a href="http://www.andong.ac.kr/main" target="_blank" class="link">홈페이지</a></div>' + 
                    '            </div>' + 
                    '        </div>' + 
                    '    </div>' +    
                    '</div>';

        // 마커 위에 커스텀오버레이를 표시합니다
        // 마커를 중심으로 커스텀 오버레이를 표시하기위해 CSS를 이용해 위치를 설정했습니다
        var overlay = new kakao.maps.CustomOverlay({
            content: content,
            map: map,
            position: marker.getPosition()       
        });

        // 마커를 클릭했을 때 커스텀 오버레이를 표시합니다
        kakao.maps.event.addListener(marker, 'click', function() {
            overlay.setMap(map);
        });

        // 커스텀 오버레이를 닫기 위해 호출되는 함수입니다 
        function closeOverlay() {
            overlay.setMap(null);     
        }


    });
</script>

{% endblock %}